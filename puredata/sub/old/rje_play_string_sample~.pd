#N canvas -8 -8 1920 1037 10;
#X obj 440 30 inlet;
#X obj 504 967 outlet~ right;
#X obj 377 968 outlet~ left;
#X obj 918 460 r constant_string_start;
#X obj 897 384 r constant_string_full;
#X obj 14 114 soundfiler;
#X obj 14 29 loadbang;
#X obj 380 265 tabplay~ \$0-string_sample;
#X obj 633 105 spigot;
#X obj 633 127 bng 15 250 50 0 empty empty empty 17 7 0 10 -262144
-1 -1;
#X obj 919 132 spigot;
#X msg 919 179 stop;
#X obj 946 76 expr if ($f1 == 0 \, 1 \, 0);
#N canvas 0 50 1080 759 (subpatch) 0;
#X array \$0-string_sample 926100 float 2;
#X coords 0 1 926100 -1 200 140 1 0 0;
#X restore 14 180 graph;
#X obj 14 53 f \$0;
#X msg 14 78 read -maxsize 1.35e+007 -resize ../samples/string.wav
\$1-string_sample;
#X msg 660 49 \$2;
#X msg 946 55 \$2;
#X obj 14 138 s \$0-instruct_tab;
#X obj 380 242 r \$0-instruct_tab;
#X obj 633 151 s \$0-instruct_tab;
#X obj 919 213 s \$0-instruct_tab;
#X obj 440 55 s \$0-key_velo;
#X obj 633 27 r \$0-key_velo;
#X obj 919 29 r \$0-key_velo;
#X text 630 9 if velo > 0 play;
#X text 917 9 if vel = 0 stop;
#X text 13 9 load string sample;
#X obj 919 155 bng 15 250 50 0 empty empty empty 17 7 0 10 -262144
-1 -1;
#X obj 633 75 buddy;
#X obj 919 105 buddy;
#X obj 380 375 *~;
#X obj 395 350 expr $f2 / 128;
#X obj 395 329 r \$0-key_velo;
#X obj 687 597 line~;
#X obj 687 542 loadbang;
#X obj 1039 212 s \$0-stop_note;
#X obj 749 542 r \$0-stop_note;
#X obj 751 151 s \$0-start_note;
#X obj 1056 383 r \$0-start_note;
#X obj 1056 404 bng 15 250 50 0 empty empty empty 17 7 0 10 -262144
-1 -1;
#X text 690 351 ramp up volume over time;
#X obj 380 688 *~;
#X text 381 223 sound note;
#X text 439 11 input key velocity;
#X obj 897 507 pipe;
#X obj 897 435 change;
#X obj 918 484 change;
#X msg 897 531 1 \$1;
#X obj 394 765 r constant_string_volume;
#X obj 379 789 *~;
#X text 394 310 scale velocity to keypress;
#X text 392 746 reduce string velocity so not to overpower piano;
#X obj 459 803 r \$0-key_velo;
#X obj 459 825 expr $f1 - 60;
#X obj 1219 54 loadbang;
#X msg 687 568 0 5;
#X text 550 826 pitch shift by semitones minus middle c;
#X obj 1219 80 delay 1000;
#X msg 1219 108 60 1;
#X obj 1219 132 s \$0-key_velo;
#X obj 1336 108 delay 1000;
#X obj 1336 157 s \$0-key_velo;
#X msg 1336 133 60 0;
#X text 1215 17 play string briefly at start to initialise the delay
(dunno why this is needed);
#X obj 459 851 change;
#X obj 23 465 rje_is_note_on;
#X obj 23 488 switch~;
#X obj 23 443 r \$0-key_velo;
#X text 19 423 switch off this patch to save cpu;
#X obj 378 886 fx.pitchshift~;
#X obj 1380 451 fluid~;
#X obj 1380 318 loadbang;
#X obj 1381 504 outlet~;
#X obj 1451 504 outlet~;
#X msg 1380 340 @sf ../soundfonts/k-gm.sf2;
#X obj 1419 409 r \$0-key_velo;
#X msg 1389 367 prog 1 49;
#X text 1459 368 channel 1 \, strings;
#X connect 0 0 22 0;
#X connect 3 0 47 0;
#X connect 4 0 46 0;
#X connect 5 0 18 0;
#X connect 6 0 14 0;
#X connect 7 0 31 0;
#X connect 8 0 9 0;
#X connect 9 0 20 0;
#X connect 9 0 38 0;
#X connect 10 0 28 0;
#X connect 11 0 21 0;
#X connect 11 0 36 0;
#X connect 12 0 30 1;
#X connect 14 0 15 0;
#X connect 15 0 5 0;
#X connect 16 0 29 1;
#X connect 17 0 12 0;
#X connect 19 0 7 0;
#X connect 23 0 16 0;
#X connect 23 0 29 0;
#X connect 24 0 17 0;
#X connect 24 0 30 0;
#X connect 28 0 11 0;
#X connect 29 0 8 0;
#X connect 29 1 8 1;
#X connect 30 0 10 0;
#X connect 30 1 10 1;
#X connect 31 0 42 0;
#X connect 32 0 31 1;
#X connect 33 0 32 0;
#X connect 34 0 42 1;
#X connect 35 0 56 0;
#X connect 37 0 56 0;
#X connect 39 0 40 0;
#X connect 40 0 46 0;
#X connect 42 0 50 0;
#X connect 45 0 48 0;
#X connect 46 0 45 0;
#X connect 47 0 45 1;
#X connect 48 0 34 0;
#X connect 49 0 50 1;
#X connect 50 0 70 0;
#X connect 53 0 54 0;
#X connect 54 0 65 0;
#X connect 55 0 58 0;
#X connect 56 0 34 0;
#X connect 58 0 59 0;
#X connect 58 0 61 0;
#X connect 59 0 60 0;
#X connect 61 0 63 0;
#X connect 63 0 62 0;
#X connect 65 0 70 1;
#X connect 66 0 67 0;
#X connect 68 0 66 0;
#X connect 70 0 1 0;
#X connect 70 0 2 0;
#X connect 71 0 73 0;
#X connect 71 1 74 0;
#X connect 72 0 75 0;
#X connect 75 0 71 0;
#X connect 75 0 77 0;
#X connect 76 0 71 0;
#X connect 77 0 71 0;
